{% extends 'inventario/base.html' %}
{% load static %}

{% block title %}Servicios{% endblock %}

{% block content %}
<div class="card mt-5 w-100">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0"><i class="fa-solid fa-concierge-bell"></i> Gestión de Servicios</h3>
      <a href="{% url 'agregar_servicio' %}" class="btn btn-success"><i class="fa-solid fa-plus"></i> Agregar Servicio</a>
    </div>

    <!-- Filtros -->
    <form method="get" class="row g-3 mb-3">
                        <div class="col-md-4">
                            <input type="text" name="q" class="form-control" placeholder="Buscar servicios..." value="{{ q }}">
                        </div>
                        <div class="col-md-2">
                            <select name="estado" class="form-control">
                                <option value="">Todos los estados</option>
                                <option value="ACTIVO" {% if estado == 'ACTIVO' %}selected{% endif %}>Activo</option>
                                <option value="POR_VENCER" {% if estado == 'POR_VENCER' %}selected{% endif %}>Por vencer</option>
                                <option value="VENCIDO" {% if estado == 'VENCIDO' %}selected{% endif %}>Vencido</option>
                                <option value="SUSPENDIDO" {% if estado == 'SUSPENDIDO' %}selected{% endif %}>Suspendido</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select name="frecuencia" class="form-control">
                                <option value="">Todas las frecuencias</option>
                                <option value="SEMANAL" {% if frecuencia == 'SEMANAL' %}selected{% endif %}>Semanal</option>
                                <option value="QUINCENAL" {% if frecuencia == 'QUINCENAL' %}selected{% endif %}>Quincenal</option>
                                <option value="MENSUAL" {% if frecuencia == 'MENSUAL' %}selected{% endif %}>Mensual</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-search"></i> Filtrar
                            </button>
                        </div>
                        <div class="col-md-2">
                            <a href="{% url 'servicios_list' %}" class="btn btn-outline-danger w-100">
                                <i class="fas fa-times"></i> Limpiar
                            </a>
                        </div>
                    </form>
                </div>

                <!-- Tabla de servicios -->
                <div class="table-responsive rounded shadow-sm">
                    <table class="table table-hover text-nowrap">
                        <thead>
                            <tr>
                                <th>Servicio</th>
                                <th>Proveedor</th>
                                <th>Frecuencia</th>
                                <th>Costo Mensual</th>
                                <th>Fecha Inicio</th>
                                <th>Fecha Fin</th>
                                <th>Costo Total</th>
                                <th>Estado</th>
                                <th>Días para vencer</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for servicio in page_obj %}
                            <tr>
                                <td>
                                    <strong>{{ servicio.nombre }}</strong><br>
                                    <small class="text-muted">{{ servicio.descripcion|truncatechars:50 }}</small>
                                </td>
                                <td>{{ servicio.proveedor }}</td>
                                <td>
                                    <span class="badge badge-dark badge-lg">{{ servicio.get_frecuencia_display }}</span>
                                </td>
                                <td>${{ servicio.costo_mensual }}</td>
                                <td>{{ servicio.fecha_inicio|date:"d/m/Y" }}</td>
                                <td>
                                    {% if servicio.fecha_fin %}
                                        {{ servicio.fecha_fin|date:"d/m/Y" }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if servicio.calcular_costo_total %}
                                        <strong>${{ servicio.calcular_costo_total|floatformat:2 }}</strong>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if servicio.estado_actual == 'ACTIVO' %}
                                        <span class="badge badge-success-custom badge-lg font-weight-bold">
                                            <i class="fas fa-check-circle"></i> Activo
                                        </span>
                                    {% elif servicio.estado_actual == 'POR_VENCER' %}
                                        <span class="badge badge-warning-custom badge-lg font-weight-bold">
                                            <i class="fas fa-clock"></i> Por vencer
                                        </span>
                                    {% elif servicio.estado_actual == 'VENCIDO' %}
                                        <span class="badge badge-danger-custom badge-lg font-weight-bold">
                                            <i class="fas fa-times-circle"></i> Vencido
                                        </span>
                                    {% else %}
                                        <span class="badge badge-secondary-custom badge-lg font-weight-bold">{{ servicio.get_estado_display }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if servicio.dias_para_vencimiento %}
                                        {% if servicio.dias_para_vencimiento > 0 %}
                                            <span class="text-success">{{ servicio.dias_para_vencimiento }} días</span>
                                        {% elif servicio.dias_para_vencimiento == 0 %}
                                            <span class="text-warning">Hoy</span>
                                        {% else %}
                                            <span class="text-danger">Vencido hace {% widthratio servicio.dias_para_vencimiento 1 -1 %} días</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'servicio_detalle' servicio.pk %}" class="btn btn-info btn-sm" title="Ver detalle">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{% url 'editar_servicio' servicio.pk %}" class="btn btn-warning btn-sm" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="10" class="text-center text-muted">
                                    No se encontraron servicios.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Paginación -->
                {% if page_obj.has_other_pages %}
                <div class="mt-4">
                    {% include 'inventario/paginador.html' %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.badge-lg {
    font-size: 0.85em;
    padding: 0.5em 0.75em;
    font-weight: 600 !important;
}

.badge-dark {
    background-color: #343a40 !important;
    color: white !important;
}

.badge-secondary {
    background-color: #6c757d !important;
    color: white !important;
}

.badge-warning {
    background-color: #ffc107 !important;
    color: #212529 !important;
}

/* Estados con colores personalizados más oscuros */
.badge-success-custom {
    background-color: #28a745 !important;
    color: white !important;
}

.badge-warning-custom {
    background-color: #fd7e14 !important; /* Naranja más oscuro */
    color: white !important;
}

.badge-danger-custom {
    background-color: #dc3545 !important;
    color: white !important;
}

.badge-secondary-custom {
    background-color: #495057 !important; /* Gris más oscuro */
    color: white !important;
}

.card {
    transition: transform 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-2px);
}

.shadow-sm {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075) !important;
}
</style>
{% endblock %}
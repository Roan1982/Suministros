{# paginador.html - Fragmento reutilizable para paginación avanzada Bootstrap #}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2 mb-2">
  <div class="small text-muted">
    Mostrando {{ page_obj.start_index }}-{{ page_obj.end_index }} de {{ page_obj.paginator.count }} resultados. Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}.
  </div>
  <form class="d-flex align-items-center gap-2" method="get" onsubmit="return paginadorIrAPagina(this, {{ page_obj.paginator.num_pages }})">
    {# Mantener los filtros al cambiar de página #}
    {% for k, v in request.GET.items %}
      {% if k != page_param|default:'page' %}
        <input type="hidden" name="{{ k }}" value="{{ v }}">
      {% endif %}
    {% endfor %}
    <nav aria-label="Paginación">
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item {% if page_obj.number == 1 %}disabled{% endif %}">
          <a class="page-link" href="?{% for k,v in request.GET.items %}{% if k != page_param|default:'page' %}{{k}}={{v|urlencode}}&{% endif %}{% endfor %}{{ page_param|default:'page' }}=1" aria-label="Primera">«</a>
        </li>
        <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
          {% if page_obj.has_previous %}
            <a class="page-link" href="?{% for k,v in request.GET.items %}{% if k != page_param|default:'page' %}{{k}}={{v|urlencode}}&{% endif %}{% endfor %}{{ page_param|default:'page' }}={{ page_obj.previous_page_number }}" aria-label="Anterior">‹</a>
          {% else %}
            <span class="page-link">‹</span>
          {% endif %}
        </li>
        {# Mostrar hasta 5 páginas consecutivas centradas en la actual #}
        {% for num in page_obj.paginator.page_range %}
          {% if num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
            {% if page_obj.number == num %}
              <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% else %}
              <li class="page-item"><a class="page-link" href="?{% for k,v in request.GET.items %}{% if k != page_param|default:'page' %}{{k}}={{v|urlencode}}&{% endif %}{% endfor %}{{ page_param|default:'page' }}={{ num }}">{{ num }}</a></li>
            {% endif %}
          {% endif %}
        {% endfor %}
        <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
          {% if page_obj.has_next %}
            <a class="page-link" href="?{% for k,v in request.GET.items %}{% if k != page_param|default:'page' %}{{k}}={{v|urlencode}}&{% endif %}{% endfor %}{{ page_param|default:'page' }}={{ page_obj.next_page_number }}" aria-label="Siguiente">›</a>
          {% else %}
            <span class="page-link">›</span>
          {% endif %}
        </li>
        <li class="page-item {% if page_obj.number == page_obj.paginator.num_pages %}disabled{% endif %}">
          <a class="page-link" href="?{% for k,v in request.GET.items %}{% if k != page_param|default:'page' %}{{k}}={{v|urlencode}}&{% endif %}{% endfor %}{{ page_param|default:'page' }}={{ page_obj.paginator.num_pages }}" aria-label="Última">»</a>
        </li>
      </ul>
    </nav>
    <label class="ms-2 mb-0 small" for="paginador-input-{{ page_param|default:'page' }}">Ir a página:</label>
    <input id="paginador-input-{{ page_param|default:'page' }}" name="{{ page_param|default:'page' }}" type="number" min="1" max="{{ page_obj.paginator.num_pages }}" class="form-control form-control-sm" style="width: 60px;" value="{{ page_obj.number }}">
    <button type="submit" class="btn btn-outline-primary btn-sm">Ir</button>
  </form>
</div>
<script>
function paginadorIrAPagina(form, maxPages) {
  var input = form.querySelector('input[name="' + '{{ page_param|default:"page" }}' + '"]');
  var val = parseInt(input.value, 10);
  if (isNaN(val) || val < 1 || val > maxPages) {
    input.classList.add('is-invalid');
    input.focus();
    return false;
  }
  input.classList.remove('is-invalid');
  return true;
}
</script>
